<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="twitter:site" content="@kivyframework">
    
    <title>Unit tests &mdash; Kivy 1.9.1 ドキュメント</title>
    <link href='//fonts.googleapis.com/css?family=Source+Code+Pro:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="static/fresh.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.9.1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="static/translations.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="static/jquery-effects-core-and-slide.js"></script>
    <script type="text/javascript" src="static/jquery.cookie.js"></script>
    <script type="text/javascript" src="static/kivy.js"></script>
    <link rel="top" title="Kivy 1.9.1 ドキュメント" href="index.html" />
    <link rel="up" title="Contributing" href="contribute.html" />
    <link rel="next" title="Google Summer of Code - 2016" href="gsoc.html" />
    <link rel="prev" title="Contributing" href="contribute.html" /> 
  </head>
  <body>

    <div id="topbar">
        <div id="topwrapper">
        <div id="toplogo">
            <a href="http://kivy.org/">
                <img src="static/logo-kivy.png" alt="Kivy" height="50"/>
            </a>
        </div>
        <div id="topmenu">
            <ul class="navigation">
                <li><a class="nav-guides" href="gettingstarted/intro.html">Guides</a></li>
                <li><a class="nav-garden" href="http://kivy-garden.github.io/">Garden</a></li>
                <li><a class="nav-api" href="api-kivy.html">API Reference</a></li>
                <li><a class="nav-pdf" href="http://kivy.org/docs/pdf/Kivy-latest.pdf">PDF</a></li>
                <li><a class="nav-wiki" href="http://wiki.kivy.org">Wiki</a></li>
            </ul>
        </div>
        </div>
    </div>
<div id="contentall">
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3>Quick search</h3>
            <form class="search" action="search.html" method="get">
                &nbsp;
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
                <input type="text" class="text" name="q" />
            </form>
          <!--
          <h3><a href="index.html">Unit tests</a></h3>
          <ul>
<li><a class="reference internal" href="#">Unit tests</a><ul>
<li><a class="reference internal" href="#how-it-works">How it works</a></li>
<li><a class="reference internal" href="#gl-unit-tests">GL unit tests</a></li>
<li><a class="reference internal" href="#writing-gl-unit-tests">Writing GL Unit tests</a></li>
<li><a class="reference internal" href="#coverage-reports">Coverage reports</a></li>
</ul>
</li>
</ul>

          <h3><a href="index.html">Table Of Contents</a></h3>
          -->
          <ul>
<li class="toctree-l1"><a class="reference internal" href="gettingstarted/index.html">Getting Started(翻訳中)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gettingstarted/intro.html">導入</a></li>
<li class="toctree-l2"><a class="reference internal" href="gettingstarted/installation.html">インストール</a></li>
<li class="toctree-l2"><a class="reference internal" href="gettingstarted/first_app.html">最初のアプリ</a></li>
<li class="toctree-l2"><a class="reference internal" href="gettingstarted/properties.html">プロパティ</a></li>
<li class="toctree-l2"><a class="reference internal" href="gettingstarted/rules.html">Kv デザイン 言語</a></li>
<li class="toctree-l2"><a class="reference internal" href="gettingstarted/events.html">イベント</a></li>
<li class="toctree-l2"><a class="reference internal" href="gettingstarted/framework.html">Non-widget stuff</a></li>
<li class="toctree-l2"><a class="reference internal" href="gettingstarted/layouts.html">Layouts(翻訳済み)</a></li>
<li class="toctree-l2"><a class="reference internal" href="gettingstarted/drawing.html">描画</a></li>
<li class="toctree-l2"><a class="reference internal" href="gettingstarted/packaging.html">Packaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="gettingstarted/examples.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="gettingstarted/diving.html">ダイビング</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples/index.html">Gallery of Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="examples/gallery.html">Gallery</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__3Drendering__main__py.html">3D Rotating Monkey Head</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__animation__animate__py.html">Widget animation</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__application__app_suite__py.html">Suite of Application Builders</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__application__app_with_build__py.html">Application example using build() + return</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__application__app_with_kv__py.html">Application built from a  .kv file</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__application__app_with_kv_in_template1__py.html">Application from a .kv in a Template Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__camera__main__py.html">Camera Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__canvas__bezier__py.html">Bezier Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__canvas__canvas_stress__py.html">Canvas stress</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__canvas__circle__py.html">Circle Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__canvas__fbo_canvas__py.html">FBO Canvas</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__canvas__lines__py.html">Line (SmoothLine) Experiment</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__canvas__lines_extended__py.html">Lines Extended Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__canvas__mesh__py.html">Mesh test</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__canvas__multitexture__py.html">Multitexture Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__canvas__repeat_texture__py.html">Repeat Texture on Resize</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__canvas__rotation__py.html">Rotation Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__canvas__stencil_canvas__py.html">Stencil demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__canvas__tesselate__py.html">Tesselate Demonstration</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__canvas__texture__py.html">Texture Wrapping and Coordinates Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__demo__camera_puzzle__py.html">Shuffled Camera Feed Puzzle</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__demo__kivycatalog__main__py.html">Kivyカタログ</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__demo__multistroke__main__py.html">Multistroke Recognition Database Demonstration</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__demo__pictures__main__py.html">Basic Picture Viewer</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__demo__shadereditor__main__py.html">Live Shader Editor</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__demo__showcase__main__py.html">Showcase of Kivy Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/gen__demo__touchtracer__main__py.html">Touch Tracer Line Drawing Demonstration</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="user-guide.html">User’s Guide(翻訳中)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="philosophy.html">Philosophy(翻訳済み)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="contribute.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="contact.html">Contact Us</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="guide-index.html">Programming Guide(翻訳中)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="guide/basic.html">Kivyの基本</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide/environment.html">Controlling the environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide/config.html">Configure Kivy</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide/architecture.html">Architectural Overview(翻訳済み)</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide/events.html">Events and Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide/inputs.html">Input management</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide/widgets.html">Widgets(翻訳済み)</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide/graphics.html">Graphics</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide/lang.html">Kv language(翻訳済み)</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide/other-frameworks.html">Integrating with other Frameworks</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide/bestpractices.html">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide/advancedgraphics.html">Advanced Graphics</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide/packaging.html">Packaging your application</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorials-index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorials/pong.html">Pong Game Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials/firstwidget.html">A Simple Paint App</a></li>
</ul>
</li>
</ul>

          <!--
          <h3>Related Topics</h3>
          <ul>
              <li>Previous: <a href="contribute.html" title="previous chapter">Contributing</a></li>
              <li>Next: <a href="gsoc.html" title="next chapter">Google Summer of Code - 2016</a></li>
          </ul>
          -->
        </div>
      </div>
    <div id="content">
    <div class="wrapper">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            <div class="toc"><h2>Table Of Contents</h2><ul>
<li><a class="reference internal" href="#">Unit tests</a><ul>
<li><a class="reference internal" href="#how-it-works">How it works</a></li>
<li><a class="reference internal" href="#gl-unit-tests">GL unit tests</a></li>
<li><a class="reference internal" href="#writing-gl-unit-tests">Writing GL Unit tests</a></li>
<li><a class="reference internal" href="#coverage-reports">Coverage reports</a></li>
</ul>
</li>
</ul>
</div>
            
  <div class="section" id="unit-tests">
<h1>Unit tests<a class="headerlink" href="#unit-tests" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>Tests are located in the kivy/tests folder. If you find a bug in Kivy, a good
thing to do can be to write a minimal case showing the issue and to ask core
devs if the behaviour shown is intended or a real bug. If you write your code
as a <a class="reference external" href="http://docs.python.org/2/library/unittest.html">unittest</a>
, it will prevent the bug from coming back unnoticed in the future,
and will make Kivy a better, stronger project. Writing a unittest may be a
really good way to get familiar with Kivy while doing something useful.</p>
<p>Unit tests are separated into two cases:</p>
<ul class="simple">
<li>Non graphical unit tests: these are standard unit tests that can run in a
console</li>
<li>Graphical unit tests: these need a GL context, and work via image comparison</li>
</ul>
<p>To be able to run unit tests, you need to install nose
(<a class="reference external" href="http://code.google.com/p/python-nose/">http://code.google.com/p/python-nose/</a>), and coverage
(<a class="reference external" href="http://nedbatchelder.com/code/coverage/">http://nedbatchelder.com/code/coverage/</a>). You can use easy_install for that:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">easy_install</span> <span class="n">nose</span> <span class="n">coverage</span>
</pre></div>
</div>
<p>Then, in the kivy directory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">test</span>
</pre></div>
</div>
<div class="section" id="how-it-works">
<h2>How it works<a class="headerlink" href="#how-it-works" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>All the tests are located in <cite>kivy/tests</cite>, and the filename starts with
<cite>test_&lt;name&gt;.py</cite>. Nose will automatically gather all the files and classes
inside this folder, and use them to generate test cases.</p>
<p>To write a test, create a file that respects the previous naming, then
start with this template:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>

<span class="k">class</span> <span class="nc">XXXTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># import class and prepare everything here.</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">test_YYY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># place your test case here</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Replace <cite>XXX</cite> with an appropriate name that covers your tests cases, then
replace &#8216;YYY&#8217; with the name of your test. If you have any doubts, check how
the other tests have been written.</p>
<p>Then, to execute them, just run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">test</span>
</pre></div>
</div>
<p>If you want to execute that file only, you can run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nosetests</span> <span class="n">kivy</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">test_yourtestcase</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div>
<div class="section" id="gl-unit-tests">
<h2>GL unit tests<a class="headerlink" href="#gl-unit-tests" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>GL unit test are more difficult. You must know that even if OpenGL is a
standard, the output/rendering is not. It depends on your GPU and the driver
used. For these tests, the goal is to save the output of the rendering at
frame X, and compare it to a reference image.</p>
<p>Currently, images are generated at 320x240 pixels, in <em>png</em> format.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Currently, image comparison is done per-pixel. This means the reference
image that you generate will only be correct for your GPU/driver. If
somebody can implement image comparison with &#8220;delta&#8221; support, patches
are welcome :)</p>
</div>
<p>To execute GL unit tests, you need to create a directory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">kivy</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">results</span>
<span class="n">make</span> <span class="n">test</span>
</pre></div>
</div>
<p>The results directory will contain all the reference images and the
generated images. After the first execution, if the results directory is empty,
no comparison will be done. It will use the generated images as reference.
After the second execution, all the images will be compared to the reference
images.</p>
<p>A html file is available to show the comparison before/after the test, and a
snippet of the associated unit test. It will be generated at:</p>
<blockquote>
<div>kivy/tests/build/index.html</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">The build directory is cleaned after each call to <cite>make test</cite>. If you don&#8217;t
want that, just use nosetests command.</p>
</div>
</div>
<div class="section" id="writing-gl-unit-tests">
<h2>Writing GL Unit tests<a class="headerlink" href="#writing-gl-unit-tests" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>The idea is to create a root widget, as you would do in
<code class="xref py py-meth docutils literal"><span class="pre">build()</span></code>, or in <code class="xref py py-func docutils literal"><span class="pre">kivy.base.runTouchApp()</span></code>.
You&#8217;ll give that root widget to a rendering function which will capture the
output in X frames.</p>
<p>Here is an example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">common</span> <span class="k">import</span> <span class="n">GraphicUnitTest</span>

<span class="k">class</span> <span class="nc">VertexInstructionTestCase</span><span class="p">(</span><span class="n">GraphicUnitTest</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_ellipse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">kivy.uix.widget</span> <span class="k">import</span> <span class="n">Widget</span>
        <span class="kn">from</span> <span class="nn">kivy.graphics</span> <span class="k">import</span> <span class="n">Ellipse</span><span class="p">,</span> <span class="n">Color</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span>

        <span class="c1"># create a root widget</span>
        <span class="n">wid</span> <span class="o">=</span> <span class="n">Widget</span><span class="p">()</span>

        <span class="c1"># put some graphics instruction on it</span>
        <span class="k">with</span> <span class="n">wid</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="n">Color</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>

        <span class="c1"># render, and capture it directly</span>
        <span class="n">r</span><span class="p">(</span><span class="n">wid</span><span class="p">)</span>

        <span class="c1"># as alternative, you can capture in 2 frames:</span>
        <span class="n">r</span><span class="p">(</span><span class="n">wid</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># or in 10 frames</span>
        <span class="n">r</span><span class="p">(</span><span class="n">wid</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>Each call to <cite>self.render</cite> (or <cite>r</cite> in our example) will generate an image named
as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">classname</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">funcname</span><span class="o">&gt;-&lt;</span><span class="n">r</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">count</span><span class="o">&gt;.</span><span class="n">png</span>
</pre></div>
</div>
<p><cite>r-call-count</cite> represents the number of times that <cite>self.render</cite> is called
inside the test function.</p>
<p>The reference images are named:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ref_</span><span class="o">&lt;</span><span class="n">classname</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">funcname</span><span class="o">&gt;-&lt;</span><span class="n">r</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">count</span><span class="o">&gt;.</span><span class="n">png</span>
</pre></div>
</div>
<p>You can easily replace the reference image with a new one if you wish.</p>
</div>
<div class="section" id="coverage-reports">
<h2>Coverage reports<a class="headerlink" href="#coverage-reports" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Coverage is based on the execution of previous tests. Statistics on code
coverage are automatically calculated during execution. You can generate an html
report of the coverage with the command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">cover</span>
</pre></div>
</div>
<p>Then, open <cite>kivy/htmlcov/index.html</cite> with your favorite web browser.</p>
</div>
</div>


            <div class="footerlinks">
            <table>
                <tr>
                    <td class="leftlink">
                  <a href="contribute.html" title="previous chapter">&laquo; Contributing</a></li>
                  </td>
                  <td class="rightlink">
                  <a href="gsoc.html" title="next chapter">Google Summer of Code - 2016 &raquo;</a>
                      </td>
                  </tr>
              </table>
              </div>
          </div>
        </div>
      </div>
      </div>
      <div class="clearer"></div>
    </div>
    </div>
<!-- Piwik --> 
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://txzone.net/piwik/" : "http://txzone.net/piwik/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 8);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="https://txzone.net/piwik/piwik.php?idsite=8" style="border:0" alt="" /></p></noscript>
<!-- End Piwik Tracking Code -->
    <!--
    <div class="footer">
      &copy; Copyright 2010, The Kivy Authors.
      Last updated on 9月 03, 2016.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.2.
</div>
-->
  </body>
</html>